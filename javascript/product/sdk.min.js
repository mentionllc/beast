'use strict';(function(n,r){"function"===typeof define&&define.amd?define([],function(){return r(n)}):"object"===typeof exports?("object"===typeof global&&(n=global),module.exports=r(n)):n.TT=r(n)})(this,function(n){function r(h){var k=h.token,d=h.secret,l=h.print,m=h.build,p=h.userId,q=h.userName,z=h.sessionId,w=h.device,r=h.latitude,u=h.longitude;if(null===w||"undefined"===typeof w)w="Browser: "+n.navigator.userAgent;var a;a=n.TTENDPOINT?n.TTENDPOINT:"api.traintracks.io/v1/events";var t;t="undefined"===
typeof XDomainRequest?h.ssl:"https:"===n.location.protocol?!0:!1;var b=[],x=!1,A=function(b){try{console.warn.apply(console,[b])}catch(a){console.log.apply(console,[b])}};this.log=function(a,f){if(!arguments.length)throw Error("No arguments!");if(!a||"string"!==typeof a)throw Error("Event type is required and should be string");var e={clientTimestamp:B(new Date),device:w,userId:p,userName:q,sessionId:z,build:m,eventType:a,data:f};if(r&&u){var c=parseFloat(r),g=parseFloat(u);isNaN(c)||isNaN(g)||(e.location=
{lat:c,lon:g})}return{level:function(c){if(l&&"undefined"!==typeof console&&"PAGE"!==c)try{console[c.toLowerCase()].call(console,e)}catch(f){console.log(e)}return{send:function(){if("object"!==typeof e.data||e.data instanceof Array||null===e.data)A(a+" won't be sent since event is not an object");else{var c=[],f=JSON.stringify(e,function(b,a){if("undefined"===typeof a)return"undefined";if("object"===typeof a&&null!==a){var e;a:{for(e=0;e<c.length;e++)if(a===c[e])break a;e=-1}if(-1!==e)return"<?>";
c.push(a)}return a});x?b.push(f):y(k,d,"["+f+"]")}}}}}};var y=function(d,f,e){x=!0;var c;c="undefined"!==typeof XDomainRequest?new XDomainRequest:new XMLHttpRequest;c.constructor===XMLHttpRequest?c.onreadystatechange=function(){4===c.readyState&&(400<=c.status?(console.error("Couldn't submit events."),410===c.status&&console.warn("This version of le_js is no longer supported!")):(301===c.status&&console.warn("This version of le_js is deprecated! Consider upgrading."),0<b.length?(y(d,f,"["+b.join(",")+
"]"),b=[]):x=!1))}:c.onload=function(){0<b.length?(y(d,f,"["+b.join(",")+"]"),b=[]):x=!1};c.open("POST",(t?"https://":"http://")+a,!0);c.constructor===XMLHttpRequest&&(c.setRequestHeader("X-Requested-With","XMLHttpRequest"),c.setRequestHeader("Content-type","application/json;charset=utf-8"),c.setRequestHeader("X-Product-Key",d),c.setRequestHeader("X-Product-Auth",C(e+f)));c.send(e)}}function D(h){function k(d,h){if("string"===typeof d&&d.length||"number"===typeof d)return d.toString();throw Error(h+
" is required and should be a string");}var d,l={ssl:!1,print:!1,endpoint:null,token:null,secret:null,userId:null,userName:null,sessionId:null,build:null,device:null},m={token:k,secret:k,userId:k,userName:k,sessionId:k,build:k},p;if("object"===typeof h)for(p in h)l[p]=h[p];else throw Error("Invalid parameters for createLogStream()");for(p in m)l[p]=m[p](l[p],p);d=new r(l);var n=function(h){if(d)return d.log.apply(this,arguments);throw Error("You must call TT.init(...) first.");};return{log:function(){n.apply(this,
arguments).level("LOG").send()}}}var q={},v=function(h){if("string"!==typeof h.name)throw Error("Name not present.");if(q.hasOwnProperty(h.name))throw Error("A logger with that name already exists!");q[h.name]=new D(h);return!0},B=function(){function h(d,h){for(var k=""+Math.abs(d);k.length<h;)k="0"+k;return(0<=d?"":"-")+k}function k(d){d=+d;var h=0;0!==d&&isFinite(d)&&(h=0<=d?Math.floor(d):Math.ceil(d));return h}return function(d){var l=d.getFullYear()+"-"+h(d.getMonth()+1,2)+"-"+h(d.getDate(),2)+
"T"+h(d.getHours(),2)+":"+h(d.getMinutes(),2)+":"+h(d.getSeconds(),2)+"."+h(k(1E3*d.getMilliseconds()),6);d=15*-Math.round(d.getTimezoneOffset()/15);var m="+";0>d&&(d=-d,m="-");d=m+h(k(d/60),2)+":"+h(k(d)%60,2);return l+d}}(),C=function(){function h(a,d){var b=(a&65535)+(d&65535);return(a>>16)+(d>>16)+(b>>16)<<16|b&65535}function k(a,d,b,k,l,m){a=h(h(d,a),h(k,m));return h(a<<l|a>>>32-l,b)}function d(a,d,b,h,l,m,n){return k(d&b|~d&h,a,d,l,m,n)}function l(a,d,b,h,l,m,n){return k(d&h|b&~h,a,d,l,m,n)}
function m(a,d,b,h,l,m,n){return k(b^(d|~h),a,d,l,m,n)}function p(a,t){a[t>>5]|=128<<t%32;a[(t+64>>>9<<4)+14]=t;var b,n,p,q,r,f=1732584193,e=-271733879,c=-1732584194,g=271733878;for(b=0;b<a.length;b+=16)n=f,p=e,q=c,r=g,f=d(f,e,c,g,a[b],7,-680876936),g=d(g,f,e,c,a[b+1],12,-389564586),c=d(c,g,f,e,a[b+2],17,606105819),e=d(e,c,g,f,a[b+3],22,-1044525330),f=d(f,e,c,g,a[b+4],7,-176418897),g=d(g,f,e,c,a[b+5],12,1200080426),c=d(c,g,f,e,a[b+6],17,-1473231341),e=d(e,c,g,f,a[b+7],22,-45705983),f=d(f,e,c,g,a[b+
8],7,1770035416),g=d(g,f,e,c,a[b+9],12,-1958414417),c=d(c,g,f,e,a[b+10],17,-42063),e=d(e,c,g,f,a[b+11],22,-1990404162),f=d(f,e,c,g,a[b+12],7,1804603682),g=d(g,f,e,c,a[b+13],12,-40341101),c=d(c,g,f,e,a[b+14],17,-1502002290),e=d(e,c,g,f,a[b+15],22,1236535329),f=l(f,e,c,g,a[b+1],5,-165796510),g=l(g,f,e,c,a[b+6],9,-1069501632),c=l(c,g,f,e,a[b+11],14,643717713),e=l(e,c,g,f,a[b],20,-373897302),f=l(f,e,c,g,a[b+5],5,-701558691),g=l(g,f,e,c,a[b+10],9,38016083),c=l(c,g,f,e,a[b+15],14,-660478335),e=l(e,c,g,
f,a[b+4],20,-405537848),f=l(f,e,c,g,a[b+9],5,568446438),g=l(g,f,e,c,a[b+14],9,-1019803690),c=l(c,g,f,e,a[b+3],14,-187363961),e=l(e,c,g,f,a[b+8],20,1163531501),f=l(f,e,c,g,a[b+13],5,-1444681467),g=l(g,f,e,c,a[b+2],9,-51403784),c=l(c,g,f,e,a[b+7],14,1735328473),e=l(e,c,g,f,a[b+12],20,-1926607734),f=k(e^c^g,f,e,a[b+5],4,-378558),g=k(f^e^c,g,f,a[b+8],11,-2022574463),c=k(g^f^e,c,g,a[b+11],16,1839030562),e=k(c^g^f,e,c,a[b+14],23,-35309556),f=k(e^c^g,f,e,a[b+1],4,-1530992060),g=k(f^e^c,g,f,a[b+4],11,1272893353),
c=k(g^f^e,c,g,a[b+7],16,-155497632),e=k(c^g^f,e,c,a[b+10],23,-1094730640),f=k(e^c^g,f,e,a[b+13],4,681279174),g=k(f^e^c,g,f,a[b],11,-358537222),c=k(g^f^e,c,g,a[b+3],16,-722521979),e=k(c^g^f,e,c,a[b+6],23,76029189),f=k(e^c^g,f,e,a[b+9],4,-640364487),g=k(f^e^c,g,f,a[b+12],11,-421815835),c=k(g^f^e,c,g,a[b+15],16,530742520),e=k(c^g^f,e,c,a[b+2],23,-995338651),f=m(f,e,c,g,a[b],6,-198630844),g=m(g,f,e,c,a[b+7],10,1126891415),c=m(c,g,f,e,a[b+14],15,-1416354905),e=m(e,c,g,f,a[b+5],21,-57434055),f=m(f,e,c,
g,a[b+12],6,1700485571),g=m(g,f,e,c,a[b+3],10,-1894986606),c=m(c,g,f,e,a[b+10],15,-1051523),e=m(e,c,g,f,a[b+1],21,-2054922799),f=m(f,e,c,g,a[b+8],6,1873313359),g=m(g,f,e,c,a[b+15],10,-30611744),c=m(c,g,f,e,a[b+6],15,-1560198380),e=m(e,c,g,f,a[b+13],21,1309151649),f=m(f,e,c,g,a[b+4],6,-145523070),g=m(g,f,e,c,a[b+11],10,-1120210379),c=m(c,g,f,e,a[b+2],15,718787259),e=m(e,c,g,f,a[b+9],21,-343485551),f=h(f,n),e=h(e,p),c=h(c,q),g=h(g,r);return[f,e,c,g]}function n(a){var d,b="";for(d=0;d<32*a.length;d+=
8)b+=String.fromCharCode(a[d>>5]>>>d%32&255);return b}function q(a){var d,b=[];b[(a.length>>2)-1]=void 0;for(d=0;d<b.length;d+=1)b[d]=0;for(d=0;d<8*a.length;d+=8)b[d>>5]|=(a.charCodeAt(d/8)&255)<<d%32;return b}function r(a){return n(p(q(a),8*a.length))}function v(a,d){var b,h=q(a),k=[],l=[];k[15]=l[15]=void 0;16<h.length&&(h=p(h,8*a.length));for(b=0;16>b;b+=1)k[b]=h[b]^909522486,l[b]=h[b]^1549556828;b=p(k.concat(q(d)),512+8*d.length);return n(p(l.concat(b),640))}function u(a){var d="",b,h;for(h=0;h<
a.length;h+=1)b=a.charCodeAt(h),d+="0123456789abcdef".charAt(b>>>4&15)+"0123456789abcdef".charAt(b&15);return d}return function(a,d,b){d?b?a=v(unescape(encodeURIComponent(d)),unescape(encodeURIComponent(a))):(a=v(unescape(encodeURIComponent(d)),unescape(encodeURIComponent(a))),a=u(a)):a=b?r(unescape(encodeURIComponent(a))):u(r(unescape(encodeURIComponent(a))));return a}}();return{init:function(h){var k={name:"default"};if("object"===typeof h)for(var d in h)k[d]=h[d];else throw Error("Invalid parameters for init()");
return v(k)},createLogStream:v,to:function(h){if(!q.hasOwnProperty(h))throw Error("Invalid name for logStream");return q[h]},destroy:function(h){"undefined"===typeof h&&(h="default");delete q[h]},log:function(){for(var h in q)q[h].log.apply(this,arguments)}}});
